#!/bin/bash

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº VPN Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."

# ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ð² Ð¿Ð°Ð¿ÐºÑƒ
cd "$(dirname "$0")"

# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²
pkill -f "python backend/app.py" 2>/dev/null || true
sleep 1

# ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
source venv/bin/activate

# Ð—Ð°Ð¿ÑƒÑÐº Flask ÑÐµÑ€Ð²ÐµÑ€Ð°
echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº Flask ÑÐµÑ€Ð²ÐµÑ€Ð°..."
python backend/app.py &
FLASK_PID=$!

# ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°
sleep 4

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
if curl -s http://localhost:5000 >/dev/null 2>&1; then
    clear
    echo "âœ… VPN Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!"
    echo ""
    echo "ðŸŒ ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ: http://localhost:5000"
    echo ""
    echo "ðŸ“‹ Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ:"
    echo "   âœ… Ð¡Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ CSS ÑÑ‚Ð¸Ð»Ð¸ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹ Ð² HTML"
    echo "   âœ… JavaScript Ð»Ð¾Ð³Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
    echo "   âœ… Ð’ÑÐµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ VPN Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹"
    echo "   âœ… Ð“Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚Ð½Ñ‹Ð¹ Ñ„Ð¾Ð½ Ð¸ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸"
    echo "   âœ… ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ/Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ VPN"
    echo ""
    echo "ðŸŽ¯ Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:"
    echo "   1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€"
    echo "   2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ: http://localhost:5000"
    echo "   3. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ VPN ÑÐµÑ€Ð²ÐµÑ€ (ÐºÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð¿Ð¾ Ð½ÐµÐ¼Ñƒ)"
    echo "   4. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ Connect"
    echo "   5. Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!"
    echo ""
    echo "Flask PID: $FLASK_PID"
else
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°"
    kill $FLASK_PID 2>/dev/null
    exit 1
fi